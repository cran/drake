<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="William Michael Landau" />

<meta name="date" content="2017-10-17" />

<title>Storage</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Storage</h1>
<h3 class="subtitle"><em>Caching, hashing, and customization</em></h3>
<h4 class="author"><em>William Michael Landau</em></h4>
<h4 class="date"><em>2017-10-17</em></h4>


<div id="TOC">
<ul>
<li><a href="#storage-basics"><span class="toc-section-number">1</span> Storage basics</a></li>
<li><a href="#caches-as-r-objects"><span class="toc-section-number">2</span> Caches as R objects</a></li>
<li><a href="#hash-algorithms"><span class="toc-section-number">3</span> Hash algorithms</a></li>
<li><a href="#which-hash-algorithm-should-you-choose"><span class="toc-section-number">4</span> Which hash algorithm should you choose?</a></li>
<li><a href="#select-the-hash-algorithms-of-the-default-cache"><span class="toc-section-number">5</span> Select the hash algorithms of the default cache</a></li>
<li><a href="#more-on-custom-caches"><span class="toc-section-number">6</span> More on custom caches</a></li>
<li><a href="#recovering-the-cache"><span class="toc-section-number">7</span> Recovering the cache</a></li>
<li><a href="#more-on-storr-caches"><span class="toc-section-number">8</span> More on <a href="https://github.com/richfitz/storr">storr</a> caches</a></li>
<li><a href="#in-memory-caches"><span class="toc-section-number">9</span> In-memory caches</a></li>
<li><a href="#cache-types"><span class="toc-section-number">10</span> Cache types</a></li>
<li><a href="#cleaning-up"><span class="toc-section-number">11</span> Cleaning up</a></li>
</ul>
</div>

<div class="figure">
<img src="data:image/png;base64,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" />

</div>
<div id="storage-basics" class="section level1">
<h1><span class="header-section-number">1</span> Storage basics</h1>
<p>When you run <code>make()</code>, <code>drake</code> puts your imports and output targets in a hidden cache, or storage location.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(drake)
<span class="kw">load_basic_example</span>()
config &lt;-<span class="st"> </span><span class="kw">make</span>(my_plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">return_config =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in make(my_plan, verbose = FALSE, return_config = TRUE):
## The return_config argument to make() is deprecated. Now, an internal
## configuration list is always invisibly returned.</code></pre>
<p>You can explore your cached data using functions like <code>loadd()</code>, <code>readd()</code>, and <code>cached()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">cached</span>())</code></pre></div>
<pre><code>## [1] &quot;'report.Rmd'&quot;           &quot;'report.md'&quot;           
## [3] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;
## [5] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(small)</code></pre></div>
<pre><code>##            x y
## 1 -0.8405761 1
## 2  0.3728460 1
## 3 -0.9197519 4
## 4 -0.8138454 4
## 5  0.6081448 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loadd</span>(large)
<span class="kw">head</span>(large)</code></pre></div>
<pre><code>##             x y
## 1 -1.04907427 1
## 2  1.48356981 0
## 3 -0.98970865 1
## 4  0.04199456 0
## 5 -0.26483752 0
## 6 -1.02497511 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(large) <span class="co"># Does not remove `large` from the cache.</span></code></pre></div>
</div>
<div id="caches-as-r-objects" class="section level1">
<h1><span class="header-section-number">2</span> Caches as R objects</h1>
<p>The <a href="https://github.com/richfitz/storr">storr</a> package does the heavy lifting. A <code>storr</code> is an object in R that serves as an abstraction for a storage backend, usually a file system. See the <a href="https://cran.r-project.org/package=storr/vignettes/storr.html">main storr vignette</a> for a thorough walkthrough.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(config$cache) <span class="co"># from `config &lt;- make(..., return_config = TRUE)`</span></code></pre></div>
<pre><code>## [1] &quot;storr&quot; &quot;R6&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cache &lt;-<span class="st"> </span><span class="kw">get_cache</span>() <span class="co"># Get the default cache from the last build.</span>
<span class="kw">class</span>(cache)</code></pre></div>
<pre><code>## [1] &quot;storr&quot; &quot;R6&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cache$<span class="kw">list</span>() <span class="co"># functionality from storr</span></code></pre></div>
<pre><code>##  [1] &quot;'report.Rmd'&quot;           &quot;'report.md'&quot;           
##  [3] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;
##  [5] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;
##  [7] &quot;coefficients&quot;           &quot;data.frame&quot;            
##  [9] &quot;knit&quot;                   &quot;large&quot;                 
## [11] &quot;lm&quot;                     &quot;reg1&quot;                  
## [13] &quot;reg2&quot;                   &quot;regression1_large&quot;     
## [15] &quot;regression1_small&quot;      &quot;regression2_large&quot;     
## [17] &quot;regression2_small&quot;      &quot;rpois&quot;                 
## [19] &quot;simulate&quot;               &quot;small&quot;                 
## [21] &quot;stats::rnorm&quot;           &quot;summ_regression1_large&quot;
## [23] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;
## [25] &quot;summ_regression2_small&quot; &quot;summary&quot;               
## [27] &quot;suppressWarnings&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cache$<span class="kw">get</span>(<span class="st">&quot;small&quot;</span>) <span class="co"># functionality from storr</span></code></pre></div>
<pre><code>## $type
## [1] &quot;object&quot;
## 
## $value
##            x y
## 1 -0.8405761 1
## 2  0.3728460 1
## 3 -0.9197519 4
## 4 -0.8138454 4
## 5  0.6081448 0
## 
## $imported
## [1] FALSE</code></pre>
</div>
<div id="hash-algorithms" class="section level1">
<h1><span class="header-section-number">3</span> Hash algorithms</h1>
<p>The key to <a href="https://github.com/richfitz/storr">storr</a>’s internals is the concept of <a href="https://en.wikipedia.org/wiki/Hash_function">hashing</a>. <a href="https://github.com/richfitz/storr">Storr</a> uses hashes to label what they store, and <code>drake</code> leverages these hashes to figure out what is up to date and what needs to be (re)built. A hash is like a fingerprint for a piece of data, so the hash should change if the dataset changes. Regardless of the data’s size, the hash always has same number of characters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(digest) <span class="co"># package for hashing objects and files</span>
smaller_data &lt;-<span class="st"> </span><span class="dv">12</span>
larger_data &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)
<span class="kw">digest</span>(smaller_data) <span class="co"># compute the hash</span></code></pre></div>
<pre><code>## [1] &quot;23c80a31c0713176016e6e18d76a5f31&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">digest</span>(larger_data)</code></pre></div>
<pre><code>## [1] &quot;dcac878fe45f6220e8fb6194e67243da&quot;</code></pre>
<p>However, different hash algorithms vary in output length.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">digest</span>(larger_data, <span class="dt">algo =</span> <span class="st">&quot;sha512&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;4665f744a15b53d289c95c6cfc9a5c63eec0321756d38b790398c916a42d4779e6e915b63913c30bdac38576eccca7630bc4793e34865f6666acea308dcc5de7&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">digest</span>(larger_data, <span class="dt">algo =</span> <span class="st">&quot;md5&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;dcac878fe45f6220e8fb6194e67243da&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">digest</span>(larger_data, <span class="dt">algo =</span> <span class="st">&quot;xxhash64&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;0779a0749e7b5165&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">digest</span>(larger_data, <span class="dt">algo =</span> <span class="st">&quot;murmur32&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;1ba7b6d5&quot;</code></pre>
</div>
<div id="which-hash-algorithm-should-you-choose" class="section level1">
<h1><span class="header-section-number">4</span> Which hash algorithm should you choose?</h1>
<p>Hashing is expensive, and unsurprisingly, shorter hashes are usually faster to compute. So why not always use <code>murmur32</code>? One reason is the risk of collisions: when two different objects have the same hash. In general, shorter hashes have higher risks of collisions. We want our fingerprints to be unique. On the other hand, a longer hash is not always the answer. Besides speed, the decision depends on how we use the output. <code>Drake</code> and <a href="https://github.com/richfitz/storr">storr</a> both use hash keys as names for internal cache files, and in general, file names should respect the 260-character cap on Windows file paths. That is why <code>drake</code> uses a shorter hash algorithm for internal cache-related file names and a longer hash algorithm for everything else.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">default_short_hash_algo</span>() <span class="co"># for drake</span></code></pre></div>
<pre><code>## [1] &quot;xxhash64&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">default_long_hash_algo</span>()</code></pre></div>
<pre><code>## [1] &quot;sha256&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">short_hash</span>(cache)</code></pre></div>
<pre><code>## [1] &quot;xxhash64&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">long_hash</span>(cache)</code></pre></div>
<pre><code>## [1] &quot;sha256&quot;</code></pre>
</div>
<div id="select-the-hash-algorithms-of-the-default-cache" class="section level1">
<h1><span class="header-section-number">5</span> Select the hash algorithms of the default cache</h1>
<p>For new projects, use <code>new_cache()</code> to set the hashes of the default cache.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cache_path</span>(cache) <span class="co"># default cache from before</span></code></pre></div>
<pre><code>## [1] &quot;/tmp/Rtmp3fe9pW/Rbuild24bf574dbaea/drake/vignettes/.drake&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clean</span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>) <span class="co"># start from scratch to reset both hash algorithms</span>
tmp &lt;-<span class="st"> </span><span class="kw">new_cache</span>(
  <span class="dt">path =</span> <span class="kw">default_cache_path</span>(), <span class="co"># the `.drake/` folder</span>
  <span class="dt">short_hash_algo =</span> <span class="st">&quot;crc32&quot;</span>,
  <span class="dt">long_hash_algo =</span> <span class="st">&quot;sha1&quot;</span>
)</code></pre></div>
<p>The cache at <code>default_cache_path()</code> (equivalently, the <code>.drake/</code> folder) is the default cache used for <code>make()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">make</span>(my_plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">return_config =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in make(my_plan, verbose = FALSE, return_config = TRUE):
## The return_config argument to make() is deprecated. Now, an internal
## configuration list is always invisibly returned.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">short_hash</span>(config$cache) <span class="co"># would have been xxhash64 (default_short_hash_algo())</span></code></pre></div>
<pre><code>## [1] &quot;crc32&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">long_hash</span>(config$cache) <span class="co"># would have been sha256 (default_long_hash_algo())</span></code></pre></div>
<pre><code>## [1] &quot;sha1&quot;</code></pre>
<p>You can change the long hash algorithm without throwing away the cache, but the project will rebuild from scratch. As for the short hash, you are committed until you delete the cache and its supporting files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">outdated</span>(my_plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="co"># empty</span>
config$cache &lt;-<span class="st"> </span><span class="kw">configure_cache</span>(
  config$cache,
  <span class="dt">long_hash_algo =</span> <span class="st">&quot;murmur32&quot;</span>,
  <span class="dt">overwrite_hash_algos =</span> <span class="ot">TRUE</span>
)</code></pre></div>
<p>Below, the targets become outdated because the existing hash keys do not match the new hash algorithm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">outdated</span>(my_plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##  [1] &quot;'report.md'&quot;            &quot;coef_regression1_large&quot;
##  [3] &quot;coef_regression1_small&quot; &quot;coef_regression2_large&quot;
##  [5] &quot;coef_regression2_small&quot; &quot;large&quot;                 
##  [7] &quot;regression1_large&quot;      &quot;regression1_small&quot;     
##  [9] &quot;regression2_large&quot;      &quot;regression2_small&quot;     
## [11] &quot;small&quot;                  &quot;summ_regression1_large&quot;
## [13] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;
## [15] &quot;summ_regression2_small&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">make</span>(my_plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">return_config =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in make(my_plan, verbose = FALSE, return_config = TRUE):
## The return_config argument to make() is deprecated. Now, an internal
## configuration list is always invisibly returned.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">short_hash</span>(config$cache) <span class="co"># same as before</span></code></pre></div>
<pre><code>## [1] &quot;crc32&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">long_hash</span>(config$cache) <span class="co"># different from before</span></code></pre></div>
<pre><code>## [1] &quot;murmur32&quot;</code></pre>
</div>
<div id="more-on-custom-caches" class="section level1">
<h1><span class="header-section-number">6</span> More on custom caches</h1>
<p>You do not need to use the default cache whose files are at <code>default_cache_path()</code> (<code>.drake/</code>). However, if you use a different file system, such as the custom <code>faster_cache/</code> folder below, you will need to manually supply the cache to all functions that require one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faster_cache &lt;-<span class="st"> </span><span class="kw">new_cache</span>(
  <span class="dt">path =</span> <span class="st">&quot;faster_cache&quot;</span>,
  <span class="dt">short_hash_algo =</span> <span class="st">&quot;murmur32&quot;</span>,
  <span class="dt">long_hash_algo =</span> <span class="st">&quot;murmur32&quot;</span>
)
<span class="kw">cache_path</span>(faster_cache)</code></pre></div>
<pre><code>## [1] &quot;/tmp/Rtmp3fe9pW/Rbuild24bf574dbaea/drake/vignettes/faster_cache&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cache_path</span>(cache) <span class="co"># location of the previous cache</span></code></pre></div>
<pre><code>## [1] &quot;/tmp/Rtmp3fe9pW/Rbuild24bf574dbaea/drake/vignettes/.drake&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">short_hash</span>(faster_cache)</code></pre></div>
<pre><code>## [1] &quot;murmur32&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">long_hash</span>(faster_cache)</code></pre></div>
<pre><code>## [1] &quot;murmur32&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_plan &lt;-<span class="st"> </span><span class="kw">plan</span>(
  <span class="dt">simple =</span> <span class="dv">1</span> +<span class="st"> </span><span class="dv">1</span>
)
<span class="kw">make</span>(new_plan, <span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## check 1 item: simple
## target simple</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cached</span>(<span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## [1] &quot;simple&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(simple, <span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="recovering-the-cache" class="section level1">
<h1><span class="header-section-number">7</span> Recovering the cache</h1>
<p>You can recover an old cache from the file system. You could use <code>storr::storr_rds()</code> directly if you know the short hash algorithm, but <code>this_cache()</code> and <code>recover_cache()</code> are safer for <code>drake</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">old_cache &lt;-<span class="st"> </span><span class="kw">this_cache</span>(<span class="st">&quot;faste_cache&quot;</span>) <span class="co"># Get a cache you know exists...</span>
recovered &lt;-<span class="st"> </span><span class="kw">recover_cache</span>(<span class="st">&quot;faster_cache&quot;</span>) <span class="co"># or create a new one if missing.</span></code></pre></div>
</div>
<div id="more-on-storr-caches" class="section level1">
<h1><span class="header-section-number">8</span> More on <a href="https://github.com/richfitz/storr">storr</a> caches</h1>
<p>If you want bypass <code>drake</code> and generate a cache directly from <a href="https://github.com/richfitz/storr">storr</a>, it is best to do so right from the beginning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(storr)
my_storr &lt;-<span class="st"> </span><span class="kw">storr_rds</span>(<span class="st">&quot;my_storr&quot;</span>, <span class="dt">mangle_key =</span> <span class="ot">TRUE</span>)
<span class="kw">make</span>(new_plan, <span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## Unloading targets from environment:
##   simple
## check 1 item: simple</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cached</span>(<span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## [1] &quot;simple&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(simple, <span class="dt">cache =</span> faster_cache)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<p><code>Drake</code> supports <a href="https://github.com/richfitz/storr">storr_rds()</a> caches. Other caches may be possible, but they should have a <code>storr</code>-like API and <a href="https://github.com/richfitz/storr/blob/master/vignettes/storr.Rmd#namespaces">namespace support</a>.</p>
</div>
<div id="in-memory-caches" class="section level1">
<h1><span class="header-section-number">9</span> In-memory caches</h1>
<p>Some caches store your data in the computer’s memory rather than saved files. <code>Drake</code> can make use of these in-memory caches, but not with any kind of parallel computing. In other words, when you call <code>make()</code>, the <code>parallelism</code> argument cannot be <code>&quot;Makefile&quot;</code> and <code>jobs</code> must be <code>1</code> (default). Also, keep in mind that unless you save your workspace, your in-memory cache will disappear when you close your R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">memory_cache &lt;-<span class="st"> </span><span class="kw">storr_environment</span>()
other_plan &lt;-<span class="st"> </span><span class="kw">plan</span>(
  <span class="dt">some_data =</span> <span class="kw">rnorm</span>(<span class="dv">50</span>),
  <span class="dt">more_data =</span> <span class="kw">rpois</span>(<span class="dv">75</span>, <span class="dt">lambda =</span> <span class="dv">10</span>),
  <span class="dt">result =</span> <span class="kw">mean</span>(<span class="kw">c</span>(some_data, more_data))
)
<span class="kw">make</span>(other_plan, <span class="dt">cache =</span> memory_cache)</code></pre></div>
<pre><code>## check 4 items: rnorm, rpois, c, mean
## import rnorm
## import rpois
## import c
## import mean
## check 2 items: some_data, more_data
## target some_data
## target more_data
## check 1 item: result
## target result</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cached</span>(<span class="dt">cache =</span> memory_cache)</code></pre></div>
<pre><code>## [1] &quot;c&quot;         &quot;mean&quot;      &quot;more_data&quot; &quot;result&quot;    &quot;rnorm&quot;     &quot;rpois&quot;    
## [7] &quot;some_data&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(result, <span class="dt">cache =</span> memory_cache)</code></pre></div>
<pre><code>## [1] 6.121254</code></pre>
</div>
<div id="cache-types" class="section level1">
<h1><span class="header-section-number">10</span> Cache types</h1>
<p><code>Drake</code> has functions to help you create caches with known supported types.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">default_cache_type</span>()</code></pre></div>
<pre><code>## [1] &quot;storr_rds&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cache_types</span>()</code></pre></div>
<pre><code>## [1] &quot;storr_rds&quot;         &quot;storr_environment&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">in_memory_cache_types</span>()</code></pre></div>
<pre><code>## [1] &quot;storr_environment&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">env &lt;-<span class="st"> </span><span class="kw">new.env</span>()
my_type &lt;-<span class="st"> </span><span class="kw">new_cache</span>(<span class="dt">type =</span> <span class="st">&quot;storr_environment&quot;</span>)
my_type_2 &lt;-<span class="st"> </span><span class="kw">new_cache</span>(<span class="dt">type =</span> <span class="st">&quot;storr_environment&quot;</span>, <span class="dt">envir =</span> env)
<span class="kw">ls</span>(env)</code></pre></div>
<pre><code>## [1] &quot;data&quot;           &quot;hash_algorithm&quot; &quot;keys&quot;</code></pre>
<p>For new in-memory caches, please use <code>new_cache()</code> rather than <code>get_cache()</code> or <code>recover_cache()</code>.</p>
</div>
<div id="cleaning-up" class="section level1">
<h1><span class="header-section-number">11</span> Cleaning up</h1>
<p>If you want to start from sratch, you can <code>clean()</code> the cache. Use the <code>destroy</code> argument to remove it completely. <code>cache$del()</code> and <code>cache$destroy()</code> are also options, but they leave output file targets dangling. By contrast, <code>clean(destroy = TRUE)</code> removes file targets generated by <code>drake::make()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clean</span>(small, large)
<span class="kw">cached</span>() <span class="co"># 'small' and 'large' are gone</span></code></pre></div>
<pre><code>##  [1] &quot;'report.Rmd'&quot;           &quot;'report.md'&quot;           
##  [3] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;
##  [5] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;
##  [7] &quot;coefficients&quot;           &quot;data.frame&quot;            
##  [9] &quot;knit&quot;                   &quot;lm&quot;                    
## [11] &quot;reg1&quot;                   &quot;reg2&quot;                  
## [13] &quot;regression1_large&quot;      &quot;regression1_small&quot;     
## [15] &quot;regression2_large&quot;      &quot;regression2_small&quot;     
## [17] &quot;rpois&quot;                  &quot;simulate&quot;              
## [19] &quot;stats::rnorm&quot;           &quot;summ_regression1_large&quot;
## [21] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;
## [23] &quot;summ_regression2_small&quot; &quot;summary&quot;               
## [25] &quot;suppressWarnings&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">clean</span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>)
<span class="kw">clean</span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>, <span class="dt">cache =</span> faster_cache)
<span class="kw">clean</span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>, <span class="dt">cache =</span> my_storr)</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
